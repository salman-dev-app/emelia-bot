# render.yaml
services:
  - type: web
    name: emelia-bot
    env: python
    buildCommand: pip install -r requirements.txt
    startCommand: python run.py
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: BOT_TOKEN
        sync: false
      - key: API_ID
        sync: false
      - key: API_HASH
        sync: false
      - key: ADMIN_IDS
        sync: false
      - key: SECRET_KEY
        generateValue: true
      - key: DASHBOARD_USERNAME
        value: admin
      - key: DASHBOARD_PASSWORD
        sync: false

---
# Procfile
web: python run.py

---
# runtime.txt
python-3.11.0

---
# .env.example
# Telegram Bot Configuration
BOT_TOKEN=your_bot_token_here
API_ID=your_api_id_here
API_HASH=your_api_hash_here

# Admin User IDs (comma-separated)
ADMIN_IDS=123456789,987654321

# Web Dashboard
SECRET_KEY=change-this-secret-key
DASHBOARD_USERNAME=admin
DASHBOARD_PASSWORD=your_secure_password

# Deployment
PORT=5000
WEB_HOST=0.0.0.0
USE_WEBHOOK=false
WEBHOOK_URL=

# Optional
TIMEZONE=UTC

---
# .gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg

# Virtual Environment
venv/
ENV/
env/
.venv

# Database
*.db
*.sqlite
*.sqlite3
data/

# Environment
.env
.env.local

# Logs
logs/
*.log

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Music cache
music_cache/

---
# run.py (Main entry point for both bot and web)
import threading
import logging
from bot.main import main as run_bot
from web.app import run_web_server

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)

def start_web():
    """Start web dashboard in separate thread"""
    run_web_server()

def start_bot():
    """Start Telegram bot"""
    run_bot()

if __name__ == '__main__':
    # Start web dashboard in background thread
    web_thread = threading.Thread(target=start_web, daemon=True)
    web_thread.start()
    
    # Start bot in main thread
    start_bot()
